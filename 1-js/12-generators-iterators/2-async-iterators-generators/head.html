<script>
  async function* fetchCommits(repo) {
    let url = `https://api.github.com/repos/${repo}/commits`;

    while (url) {
      const response = await fetch(url, {
        headers: {'User-Agent': 'Our script'}, // github requires user-agent header
      });

      const commits = await response.json(); // parses response as JSON (array of commits)

      // the URL of the next page is in the headers, extract it
      url = response.headers.get('Link').match(/<([^>]+)>; rel="next"/)?.[1];

      // yield commits one by one, when they finish - fetch a new page url
      for (const commit of commits) {
        yield commit;
      }
    }
  }
</script>
